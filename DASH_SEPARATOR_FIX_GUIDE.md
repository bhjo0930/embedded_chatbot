# 🔧 대시(---) 구분선 처리 문제 수정 가이드

## 🚨 문제 상황

### 발생 현상
- AI 응답에서 "---" 문자가 그대로 텍스트로 표시됨
- 마크다운 수평선이 시각적 구분선으로 변환되지 않음
- 테이블 구분선이 완전히 필터링되지 않아 일부 "---" 텍스트가 노출됨

### 문제 원인
1. **마크다운 수평선 미처리**: `---`, `***`, `___` 패턴을 `<hr>` 태그로 변환하는 로직 없음
2. **테이블 구분선 필터링 불완전**: 다양한 형태의 테이블 구분선 패턴을 모두 감지하지 못함
3. **독립 구분선 미처리**: 테이블이 아닌 독립적인 구분선 텍스트 처리 없음

## ✅ 적용된 수정사항

### 1. 마크다운 수평선 처리 추가
```javascript
// 수평선 패턴 감지 및 처리
if (line.match(/^\s*[-*_]{3,}\s*$/)) {
    this.processHorizontalRule(line, fragment);
    return;
}

// 수평선 생성 함수
processHorizontalRule(line, fragment) {
    const hr = document.createElement('hr');
    hr.style.cssText = `
        border: none;
        border-top: 2px solid #e2e8f0;
        margin: 20px 0;
        width: 100%;
    `;
    fragment.appendChild(hr);
}
```

### 2. 테이블 구분선 필터링 강화
```javascript
// 수정 전: 기본적인 구분선만 감지
const isSeparator = /^[\s\|:\-]+$/.test(trimmed);

// 수정 후: 다양한 구분선 패턴 감지
const isSeparator = /^[\s\|:\-]+$/.test(trimmed) || 
                   /^\|[\s:\-\|]*\|$/.test(trimmed) ||
                   /^[\s]*\|?[\s:\-]+\|?[\s]*$/.test(trimmed);
```

### 3. 독립 구분선 제거
```javascript
// 테이블이 아닌 독립적인 구분선 텍스트 제거
if (line.match(/^\s*[-:|\s]+\s*$/)) {
    // 테이블 구분선이나 유사한 패턴, 건너뛰기
    return;
}
```

## 🎯 처리되는 패턴들

### 수평선 패턴 (→ `<hr>` 변환)
- `---` (3개 이상의 하이픈)
- `***` (3개 이상의 별표)  
- `___` (3개 이상의 밑줄)
- `----`, `-----` (더 많은 문자)
- 앞뒤 공백 포함된 형태도 처리

### 테이블 구분선 패턴 (→ 제거)
- `|------|------|` (기본 형태)
- `|:-----|-----:|` (정렬 포함)
- `| --- | --- |` (공백 포함)
- `:---:|:---:` (파이프 없는 형태)
- `|  :---  |  ---:  |` (다양한 공백)

### 독립 구분선 패턴 (→ 제거)
- `------` (파이프 없는 긴 하이픈)
- `: --- :` (콜론과 하이픈 조합)
- `| --- |` (단일 구분선)

## 🧪 테스트 방법

### 1. 마크다운 수평선 테스트
```
AI 요청: "다음 형식으로 답변해주세요: 내용1 --- 내용2 --- 내용3"
예상 결과: "---"가 시각적 수평선으로 변환됨
```

### 2. 테이블 구분선 테스트
```
AI 요청: "제품 비교표를 만들어주세요"
예상 결과: 테이블 구분선이 화면에 표시되지 않음
```

### 3. 혼합 콘텐츠 테스트
```
AI 요청: "제목, 구분선, 표, 구분선, 설명 순으로 답변해주세요"
예상 결과: 수평선과 테이블이 모두 올바르게 처리됨
```

## 📊 수정 전후 비교

### 수정 전 (문제 상황)
```html
<div class="ai-chatbot-message-content">
    첫 번째 내용
    ---  <!-- 텍스트로 그대로 표시 -->
    두 번째 내용
    
    | 제품 | 가격 |
    |------|------|  <!-- 구분선이 텍스트로 표시 -->
    | A | 1000원 |
</div>
```

### 수정 후 (정상 상황)
```html
<div class="ai-chatbot-message-content">
    첫 번째 내용
    <hr style="border: none; border-top: 2px solid #e2e8f0; margin: 20px 0; width: 100%;">
    두 번째 내용
    
    <div class="markdown-table">
        <!-- 구분선 없이 깔끔한 테이블 -->
        <div class="markdown-table-row">...</div>
    </div>
</div>
```

## 🎨 수평선 스타일링

### 적용된 스타일
```css
hr {
    border: none;                    /* 기본 테두리 제거 */
    border-top: 2px solid #e2e8f0;  /* 상단에 얇은 선 */
    margin: 20px 0;                 /* 위아래 여백 */
    width: 100%;                    /* 전체 너비 */
}
```

### 시각적 효과
- 내용을 명확하게 구분하는 얇은 회색 선
- 적절한 여백으로 가독성 향상
- 사이드바 너비에 맞는 반응형 크기

## 🔍 디버깅 방법

### 1. 콘솔 모니터링
```javascript
// 처리되지 않은 "---" 텍스트 확인
const messages = document.querySelectorAll('.ai-chatbot-message.bot .ai-chatbot-message-content');
const lastMessage = messages[messages.length - 1];
const dashText = lastMessage.textContent.match(/---+/g);
console.log('미처리 구분선:', dashText);
```

### 2. 요소 검사
- F12 → Elements 탭에서 `<hr>` 요소 확인
- 텍스트 노드에 "---" 문자가 남아있는지 확인
- 테이블 구조에서 구분선 텍스트 확인

### 3. 자동 모니터링
테스트 페이지에서 자동으로 구분선 처리 상태를 모니터링

## 📋 테스트 체크리스트

- [ ] **마크다운 수평선**: `---`, `***`, `___`가 `<hr>`로 변환되는가?
- [ ] **테이블 구분선**: 테이블 내 구분선이 화면에 표시되지 않는가?
- [ ] **독립 구분선**: 테이블이 아닌 구분선 텍스트가 제거되는가?
- [ ] **수평선 스타일**: `<hr>` 요소가 적절한 스타일로 표시되는가?
- [ ] **혼합 콘텐츠**: 수평선과 테이블이 함께 있을 때 올바르게 처리되는가?
- [ ] **여백**: 수평선 앞뒤로 적절한 여백이 있는가?

## 🔄 추가 개선 계획

1. **커스텀 수평선 스타일**: 사용자 설정에 따른 수평선 스타일 변경
2. **테마별 색상**: 다크/라이트 테마에 따른 수평선 색상 조정
3. **애니메이션**: 수평선 등장 시 부드러운 애니메이션 효과
4. **다양한 구분선**: 점선, 이중선 등 다양한 수평선 스타일 지원

이제 AI 응답에서 "---" 텍스트가 아름다운 수평선으로 변환되어 내용을 시각적으로 구분해줍니다!