<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="chatbot-container">
        <!-- Header -->
        <div class="chatbot-header">
            <div class="header-info">
                <div class="bot-avatar" id="bot-avatar">ðŸ¤–</div>
                <div class="bot-details">
                    <h3 class="bot-name" id="bot-name">General AI</h3>
                    <span class="bot-status" id="connection-status">Connected</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-icon" id="summarize-page" title="Summarize Page">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 4a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8m0 2a6 6 0 0 0-6 6 6 6 0 0 0 6 6 6 6 0 0 0 6-6 6 6 0 0 0-6-6m-1 5h2v6h-2v-6m-1 7h4v2h-4v-2Z"/>
                    </svg>
                </button>
                <button class="btn-icon" id="settings-btn" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
                    </svg>
                </button>
                <button class="btn-icon" id="clear-chat" title="Clear Chat">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Category Selection -->
        <div class="category-selector" id="category-selector">
            <div class="category-header">
                <span class="category-title">Select AI Agent: <span class="selected-category">General</span></span>
                <button class="category-toggle" id="category-toggle" title="Toggle Categories">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7,10L12,15L17,10H7Z"/>
                    </svg>
                </button>
            </div>
            <div class="category-options" id="category-options">
                <!-- Categories will be populated dynamically based on user settings -->
            </div>
        </div>

        <!-- Chat Messages -->
        <div class="chat-messages" id="chat-messages">
            <div class="welcome-message">
                <div class="message-bubble bot-message">
                    <div class="message-content">
                        ðŸ‘‹ Hello! I'm your AI assistant. How can I help you today?
                    </div>
                    <div class="message-time">Just now</div>
                </div>
            </div>
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typing-indicator" style="display: none;">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <span class="typing-text">AI is typing...</span>
        </div>

        <!-- Input Area -->
        <div class="chat-input-container">
            <div class="input-wrapper">
                <textarea 
                    id="message-input" 
                    placeholder="Type your message..." 
                    rows="1"
                    maxlength="2000"
                ></textarea>
                <button id="send-button" class="send-button" disabled>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                    </svg>
                </button>
            </div>
            <div class="input-info">
                <span class="char-count" id="char-count">0/2000</span>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="btn-close" id="close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="backend-select">AI Backend</label>
                    <select id="backend-select">
                        <option value="n8n">n8n Webhook</option>
                        <option value="ollama">Ollama (Local)</option>
                    </select>
                </div>
                
                <div class="form-group" id="n8n-url-group">
                    <label for="webhook-url">n8n Webhook URL</label>
                    <input type="url" id="webhook-url" placeholder="https://your-n8n-instance.com/webhook/chatbot">
                    <small class="form-help">Enter your n8n webhook endpoint URL</small>
                </div>
                
                <div class="form-group" id="ollama-url-group" style="display: none;">
                    <label for="ollama-url">Ollama URL</label>
                    <input type="url" id="ollama-url" placeholder="http://localhost:11434" value="http://localhost:11434">
                    <small class="form-help">Enter your Ollama instance URL</small>
                </div>
                
                <div class="form-group" id="ollama-model-group" style="display: none;">
                    <label for="ollama-model">Model</label>
                    <select id="ollama-model">
                        <option value="">Auto-select</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="api-timeout">Request Timeout (seconds)</label>
                    <input type="number" id="api-timeout" min="5" max="60" value="30">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="save-history"> Save chat history
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancel-settings">Cancel</button>
                <button class="btn-primary" id="save-settings">Save Settings</button>
            </div>
        </div>
    </div>

    <script src="../lib/utils.js"></script>
    <script src="popup.js"></script>
</body>
</html>