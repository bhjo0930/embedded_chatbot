<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대시(---) 구분선 처리 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .problem-example {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f44336;
        }
        .solution-example {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .test-request {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        .markdown-example {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>🔧 대시(---) 구분선 처리 문제 수정 테스트</h1>
    
    <div class="test-section">
        <h2>문제 상황</h2>
        <div class="problem-example">
            <h3>❌ 발생하는 문제</h3>
            <ul>
                <li>AI 응답에서 "---" 문자가 그대로 표시됨</li>
                <li>마크다운 수평선이 처리되지 않음</li>
                <li>테이블 구분선이 완전히 필터링되지 않음</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>테스트 1: 마크다운 수평선</h2>
        <div class="test-request">
            <p><strong>AI에게 요청:</strong></p>
            <blockquote>
                "다음과 같은 형식으로 답변해주세요:<br>
                첫 번째 내용<br>
                ---<br>
                두 번째 내용<br>
                ---<br>
                세 번째 내용"
            </blockquote>
        </div>
        
        <h3>마크다운 수평선 패턴:</h3>
        <div class="markdown-example">첫 번째 내용

---

두 번째 내용

***

세 번째 내용

___

네 번째 내용</div>

        <div class="solution-example">
            <h3>✅ 예상 결과 (수정 후)</h3>
            <ul>
                <li>"---" 텍스트가 수평선(hr)으로 변환됨</li>
                <li>"***", "___"도 수평선으로 처리됨</li>
                <li>내용들이 시각적으로 구분됨</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>테스트 2: 테이블과 구분선</h2>
        <div class="test-request">
            <p><strong>AI에게 요청:</strong></p>
            <blockquote>
                "제품 비교표를 만들어주세요"
            </blockquote>
        </div>
        
        <h3>예상 마크다운 응답:</h3>
        <div class="markdown-example">| 제품명 | 가격 | 특징 |
|--------|------|------|
| 제품 A | 10,000원 | 기본형 |
| 제품 B | 20,000원 | 고급형 |</div>

        <div class="solution-example">
            <h3>✅ 예상 결과</h3>
            <ul>
                <li>테이블 구분선 "|--------|------|------|"이 화면에 표시되지 않음</li>
                <li>깔끔한 테이블만 표시됨</li>
                <li>구분선이 텍스트로 나타나지 않음</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>테스트 3: 혼합 콘텐츠</h2>
        <div class="test-request">
            <p><strong>AI에게 요청:</strong></p>
            <blockquote>
                "프로젝트 개요를 다음 형식으로 작성해주세요:<br>
                - 제목<br>
                - 구분선<br>
                - 목표 리스트<br>
                - 구분선<br>
                - 일정 표"
            </blockquote>
        </div>
    </div>

    <div class="test-section">
        <h2>🔧 적용된 수정사항</h2>
        <ul>
            <li><strong>수평선 처리 추가</strong>: <code>---</code>, <code>***</code>, <code>___</code> 패턴을 &lt;hr&gt; 태그로 변환</li>
            <li><strong>구분선 필터링 강화</strong>: 테이블 구분선 패턴을 더 정확하게 감지</li>
            <li><strong>독립 구분선 제거</strong>: 테이블이 아닌 독립적인 구분선 텍스트 제거</li>
            <li><strong>수평선 스타일링</strong>: 적절한 여백과 색상으로 시각적 구분</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>🔍 처리되는 패턴들</h2>
        
        <h3>수평선 패턴 (→ &lt;hr&gt; 변환)</h3>
        <ul>
            <li><code>---</code> (3개 이상의 하이픈)</li>
            <li><code>***</code> (3개 이상의 별표)</li>
            <li><code>___</code> (3개 이상의 밑줄)</li>
            <li><code>----</code>, <code>-----</code> (더 많은 문자도 처리)</li>
        </ul>

        <h3>테이블 구분선 패턴 (→ 제거)</h3>
        <ul>
            <li><code>|------|------|</code></li>
            <li><code>|:-----|-----:|</code> (정렬 포함)</li>
            <li><code>| --- | --- |</code> (공백 포함)</li>
            <li><code>:---:|:---:</code> (파이프 없는 형태)</li>
        </ul>

        <h3>독립 구분선 패턴 (→ 제거)</h3>
        <ul>
            <li><code>------</code> (파이프 없는 긴 하이픈)</li>
            <li><code>: --- :</code> (콜론과 하이픈 조합)</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>📋 확인 사항</h2>
        <ol>
            <li><strong>수평선</strong>: "---" 텍스트가 시각적 구분선으로 변환되는가?</li>
            <li><strong>테이블</strong>: 테이블 구분선이 화면에 표시되지 않는가?</li>
            <li><strong>혼합 콘텐츠</strong>: 수평선과 테이블이 함께 있을 때 올바르게 처리되는가?</li>
            <li><strong>스타일링</strong>: 수평선이 적절한 여백과 색상으로 표시되는가?</li>
        </ol>
    </div>

    <script>
        console.log('🔧 대시 구분선 처리 테스트 페이지 로드됨');
        
        // 구분선 요소 모니터링
        setInterval(() => {
            const messages = document.querySelectorAll('.ai-chatbot-message.bot .ai-chatbot-message-content');
            if (messages.length > 0) {
                const lastMessage = messages[messages.length - 1];
                const hrElements = lastMessage.querySelectorAll('hr');
                const dashText = lastMessage.textContent.match(/---+/g);
                
                console.log('📊 구분선 분석:', {
                    수평선요소: hrElements.length,
                    대시텍스트: dashText ? dashText.length : 0,
                    처리상태: dashText && dashText.length > 0 ? '미처리 구분선 발견' : '정상 처리됨'
                });
                
                if (dashText && dashText.length > 0) {
                    console.warn('⚠️ 처리되지 않은 "---" 구분선이 발견되었습니다:', dashText);
                }
            }
        }, 3000);
    </script>
</body>
</html>